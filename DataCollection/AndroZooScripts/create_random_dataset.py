import csv
import random

def random_sample(input_filename, output_filename, sample_size):
    # Get the total number of rows in the csv
    with open(input_filename, 'r') as f:
        total_rows = sum(1 for row in f) - 1  # subtract 1 for header
    
    # Ensure sample size isn't greater than total rows
    if sample_size > total_rows:
        print("Sample size is greater than total number of rows!")
        return

    # Generate random sample of row indices
    random_indices = random.sample(range(1, total_rows + 1), sample_size)  # +1 because the header isn't counted
    random_indices.sort()  # sort indices for more efficient file reading
    
    # Extract and write the random samples
    with open(input_filename, 'r') as f, open(output_filename, 'w', newline='') as o:
        reader = csv.reader(f)
        writer = csv.writer(o)

        # Write the header
        header = next(reader)
        writer.writerow(header)

        # Write randomly selected rows
        count = 0  # keep track of current row number
        for idx, row in enumerate(reader, start=1):
            if idx == random_indices[count]:
                writer.writerow(row)
                count += 1
                if count == sample_size:  # all rows have been written
                    break


input_file = "../Datasets/Androzoo2022Malware.csv"
output_file = "../Datasets/Batches/MalwareAPKs1000.csv"
sample_size = 1000
random_sample(input_file, output_file, sample_size)
