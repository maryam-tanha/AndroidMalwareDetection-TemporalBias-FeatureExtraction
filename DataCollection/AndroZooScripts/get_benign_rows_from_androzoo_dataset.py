import csv
import gzip
import os

"""Objective: The objective of this code is to read a compressed CSV file, filter rows based on a condition, 
and save the filtered rows to a new CSV file. """

os.chdir('..')
current_dir = os.getcwd()

# Set the input and output file paths
input_file = current_dir + '\\Resources\\latest.csv.gz'
output_file = current_dir + '\\Resources\\benign_apks.csv'

filtered_rows = []

# Open the input CSV file
with gzip.open(input_file, 'rt', encoding='utf-8') as csv_file:
    reader = csv.DictReader(csv_file)

    for idx, row in enumerate(reader):
        try:
            # Check if the row satisfies the filtering condition
            if row['vt_detection'] == '0':
                filtered_rows.append(row)

            # Check if the limit of 1,000 iterations is reached
            if idx + 1 >= 1000:
                break
        except Exception as e:
            print(f"Error processing row {idx + 1}: {e}")

# Write the filtered rows to the output CSV file
with open(output_file, 'w', newline='') as csv_output:
    writer = csv.DictWriter(csv_output, fieldnames=reader.fieldnames)
    writer.writeheader()
    writer.writerows(filtered_rows)

print(f"Filtered rows saved to {output_file}.")
