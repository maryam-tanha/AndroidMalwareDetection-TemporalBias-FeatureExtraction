import csv

# Step 1: Read SHA keys from a .txt file and store them in an array
sha_keys = []

with open('C:/Users/sjind/ASingh/RESEARCH_ASSISTANT_MATERIAL/GITHUBREPO/DataCollection/Datasets/Batches'
          '/benignbatch3001-5000.txt', 'r') as sha_file:
    for line in sha_file:
        sha_keys.append(line.strip())

# Step 2: Read a CSV file and create a hashmap with SHA key as the key and markets as the value
sha_market_map = {}
with open('Datasets/StaticAnalysisProd/2022/BenignAPKs10000.csv', 'r', newline='') as csv_file:
    reader = csv.DictReader(csv_file)
    for row in reader:
        sha256 = row['sha256']
        market = row['markets']
        sha_market_map[sha256] = market

# Step 3: Iterate over the array of SHA keys and check if they match with play.google.com
play_store_sha_keys = []
for sha_key in sha_keys:
    if sha_key in sha_market_map and sha_market_map[sha_key] == 'play.google.com':
        play_store_sha_keys.append(sha_key)

# Step 4: Write the matching SHA keys to a new text file
with open('play_store_sha_keys.txt', 'w') as output_file:
    for sha_key in play_store_sha_keys:
        output_file.write(sha_key + '\n')
