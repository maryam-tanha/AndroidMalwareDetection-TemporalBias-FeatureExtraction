import csv
import random

# Creating batches for Malware APKs to be downloaded from Androzoo
# Things to do ->
# 1) Make sure to not download any APK from the first bath of 1000 APKs
# 2) Download the APKs randomly
# 4)
# malware_apks_set = set()
# paths = ["C:/Users/sjind/ASingh/RESEARCH_ASSISTANT_MATERIAL/GITHUBREPO/DataCollection/Datasets""/FinalAPKsToDownload"
#          "/MalwareSha256Keys.csv", "C:/Users/sjind/ASingh/RESEARCH_ASSISTANT_MATERIAL"
#                                    "/GITHUBREPO/DataCollection/Datasets""/FinalAPKsToDownload/MalwareSha256KeysV2.csv"]
# for malware_apks_1000 in paths:
#     with open(malware_apks_1000, mode='r', newline="") as input:
#         reader = csv.reader(input)
#         for line in reader:
#             value = line[0]
#             malware_apks_set.add(value)
# print(len(malware_apks_set))

def random_sample(input_filename, output_filename, sample_size):
    # Get the total number of rows in the csv
    with open(input_filename, 'r') as f:
        total_rows = sum(1 for row in f) - 1  # subtract 1 for header

    # Ensure sample size isn't greater than total rows
    if sample_size > total_rows:
        print("Sample size is greater than total number of rows!")
        return

    # Generate random sample of row indices
    random_indices = random.sample(range(1, total_rows + 1), sample_size)  # +1 because the header isn't counted
    random_indices.sort()  # sort indices for more efficient file reading

    # Extract and write the random samples
    with open(input_filename, 'r') as f, open(output_filename, 'w', newline='') as o:
        reader = csv.reader(f)
        writer = csv.writer(o)

        # Write the header
        header = next(reader)
        writer.writerow(header)

        # Write randomly selected rows
        count = 0  # keep track of current row number
        for idx, row in enumerate(reader, start=1):
            if idx == random_indices[count]:
                writer.writerow(row)
                count += 1
                if count == sample_size:  # all rows have been written
                    break


input_file = "../Datasets/benign_apks_2021.txt"
output_file = "FinalAPKsToDownload/MalwareAPKs2000Onwards.csv"
sample_size = 1000
random_sample(input_file, output_file, sample_size)

# input_file = "C:/Users/sjind/ASingh/RESEARCH_ASSISTANT_MATERIAL/CSVS/Androzoo2022Malware.csv"
# output_file = "C:/Users/sjind/ASingh/RESEARCH_ASSISTANT_MATERIAL/CSVS/Androzoo2022MalwareV3.csv"
# idx = 0
# with open(input_file, 'r', newline="") as f, open(output_file, 'w', newline="") as out:
#     rows = csv.reader(f)
#     writer = csv.writer(out)
#     for row in rows:
#         if row[0] not in malware_apks_set:
#             writer.writerow(row)
#         else:
#             idx += 1
