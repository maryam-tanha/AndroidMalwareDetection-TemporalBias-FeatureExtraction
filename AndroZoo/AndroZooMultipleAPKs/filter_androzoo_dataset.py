import csv
import gzip
import pandas as pd

input_file = 'C:/Users/sjind/ASingh/RESEARCH_ASSISTANT_MATERIAL/RAPythonCode/AndroZoo/Resources/latest.csv.gz'
output_file = './benign_apks.csv'

filtered_rows = []
# Open the input CSV file
with gzip.open(input_file, 'rt', encoding='utf-8') as csv_file:
    reader = csv.DictReader(csv_file)

    for idx, row in enumerate(reader):
        try:
            if row['vt_detection'] == '0':
                filtered_rows.append(row)

            # Check if the limit of 100,000 iterations is reached
            if idx + 1 >= 100000:
                break
        except Exception as e:
            print(f"Error processing row {idx + 1}: {e}")

# Write the filtered rows to the output CSV file
with open(output_file, 'w', newline='') as csv_output:
    writer = csv.DictWriter(csv_output, fieldnames=reader.fieldnames)
    writer.writeheader()
    writer.writerows(filtered_rows)

print(f"Filtered rows saved to {output_file}.")
