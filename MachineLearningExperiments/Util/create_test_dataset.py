import pandas as pd
import numpy as np

def validate_files(file1, file2):
    # Read the headers of both CSV files
    header1 = pd.read_csv(file1, nrows=0).columns.tolist()
    header2 = pd.read_csv(file2, nrows=0).columns.tolist()

    # Check if headers are the same
    if header1 == header2:
        return True
    else:
        return False

def create_combined_dataset(benign_file, malware_file, output_file, benign_ratio=0.9, num_samples=10000, random_seed=42):
    # Validate headers of the two CSV files
    if not validate_files(benign_file, malware_file):
        print("Error: Headers of the two files do not match.")
        return

    # Read data from CSV files
    benign_df = pd.read_csv(benign_file)
    malware_df = pd.read_csv(malware_file)

    # Sample rows based on the specified ratio
    num_benign_samples = int(num_samples * benign_ratio)
    num_malware_samples = num_samples - num_benign_samples

    benign_samples = benign_df.sample(n=num_benign_samples, random_state=random_seed)
    malware_samples = malware_df.sample(n=num_malware_samples, random_state=random_seed)

    # Concatenate sampled rows into a new DataFrame
    combined_df = pd.concat([benign_samples, malware_samples], ignore_index=True)

    # Write the combined DataFrame to a new CSV file
    combined_df.to_csv(output_file, index=False)
    print(f"Combined dataset created successfully and saved to {output_file}")

    # Remove sampled rows from the original benign and malware DataFrames
    benign_df = benign_df.drop(benign_samples.index)
    malware_df = malware_df.drop(malware_samples.index)

    # Save the modified DataFrames to new CSV files
    benign_df.to_csv(benign_file, index=False)
    malware_df.to_csv(malware_file, index=False)

    print(f"Rows removed from original datasets.")

# Specify the file paths
benign_file_path = '../Resources/permissions/all_benign_feature_vectors.csv'
malware_file_path = '../Resources/permissions/all_malware_feature_vectors.csv'
output_file_path = '../Resources/permissions/90_10_test_dataset.csv'

# Create the combined dataset with a 90:10 benign to malware ratio
create_combined_dataset(benign_file_path, malware_file_path, output_file_path, benign_ratio=0.9, num_samples=1000)
