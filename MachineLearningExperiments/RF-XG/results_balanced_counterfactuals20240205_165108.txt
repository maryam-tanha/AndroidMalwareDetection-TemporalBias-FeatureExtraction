Train set size: (9000, 2640).
Test set size: (1000, 2640).
TRAINING SET: Ratio of Benign APKs to Malware APKs:
1    0.5
0    0.5
Name: Malware, dtype: float64
TEST SET: Ratio of Benign APKs to Malware APKs:
0    0.9
1    0.1
Name: Malware, dtype: float64
There are 0 constant categorical features and we remove them!
Removed features are: [].
['sha256' 'Malware' 'android.permission.POST_NOTIFICATIONS' ...
 'Lorg/apache/xerces/impl/XMLEntityManager;->startExternalSubset'
 'Lorg/apache/xerces/util/SecurityManager;->getEntityExpansionLimit'
 'Lorg/apache/xerces/util/SecurityManager;->getMaxOccurNodeLimit']
Fitting 5 folds for each of 150 candidates, totalling 750 fits
================RANDOM FOREST RESULTS===================:
Best Parameters:  {'max_depth': 30, 'min_samples_split': 10, 'n_estimators': 1000}
Training Accuracy: 0.7301111111111112, Test Accuracy: 0.507
Training Precision: 0.65022486580589, Test Precision: 0.1641025641025641
Training Recall: 0.996, Test Recall: 0.96
Training F1 Score: 0.7867989116123935, Test F1 Score: 0.28029197080291973
Training ROC-AUC: 0.8093181975308641, Test ROC-AUC: 0.7725055555555556
Training Confusion Matrix:
[[2089 2411]
 [  18 4482]]
Test Confusion Matrix:
[[411 489]
 [  4  96]]
              precision    recall  f1-score   support

      Benign       0.99      0.46      0.63       900
     Malware       0.16      0.96      0.28       100

    accuracy                           0.51      1000
   macro avg       0.58      0.71      0.45      1000
weighted avg       0.91      0.51      0.59      1000

              precision    recall  f1-score   support

      Benign       0.99      0.46      0.63      4500
     Malware       0.65      1.00      0.79      4500

    accuracy                           0.73      9000
   macro avg       0.82      0.73      0.71      9000
weighted avg       0.82      0.73      0.71      9000

Indices of False Positives (FP): [2, 5, 6, 7, 12, 16, 20, 22, 23, 24, 25, 32, 34, 36, 40, 41, 42, 45, 47, 48, 49, 51, 54, 55, 57, 59, 61, 62, 63, 65, 66, 68, 69, 72, 74, 80, 81, 83, 87, 88, 92, 94, 95, 98, 99, 100, 101, 103, 104, 106, 108, 111, 115, 119, 121, 123, 124, 127, 128, 129, 134, 135, 136, 137, 138, 141, 143, 146, 149, 155, 156, 158, 159, 160, 164, 165, 167, 168, 169, 170, 172, 174, 175, 177, 179, 180, 181, 182, 185, 186, 189, 191, 192, 195, 196, 198, 201, 202, 203, 205, 208, 210, 213, 215, 216, 217, 220, 221, 223, 224, 225, 226, 227, 230, 234, 236, 241, 243, 246, 249, 250, 253, 254, 256, 261, 262, 264, 267, 268, 269, 270, 271, 273, 275, 279, 281, 282, 283, 284, 286, 294, 295, 299, 301, 302, 304, 307, 313, 314, 318, 319, 323, 325, 326, 330, 332, 334, 335, 336, 337, 338, 340, 341, 350, 353, 357, 360, 362, 365, 367, 369, 370, 371, 372, 373, 374, 377, 379, 381, 382, 384, 386, 387, 392, 393, 395, 397, 398, 402, 403, 404, 409, 410, 412, 415, 417, 418, 420, 422, 424, 426, 430, 433, 434, 436, 437, 438, 445, 447, 448, 453, 455, 457, 458, 460, 461, 462, 464, 465, 466, 467, 468, 470, 471, 473, 478, 479, 480, 485, 486, 489, 491, 494, 495, 496, 497, 498, 499, 500, 501, 502, 504, 510, 514, 516, 517, 520, 521, 522, 524, 525, 526, 527, 532, 533, 537, 540, 541, 542, 543, 544, 546, 548, 549, 550, 551, 553, 554, 556, 560, 562, 564, 566, 570, 571, 574, 576, 577, 580, 582, 584, 586, 587, 590, 596, 598, 599, 601, 604, 606, 607, 608, 610, 611, 612, 619, 623, 624, 629, 631, 632, 633, 634, 638, 641, 645, 647, 651, 652, 653, 655, 656, 658, 661, 664, 667, 668, 669, 671, 677, 682, 684, 688, 689, 690, 691, 692, 693, 694, 696, 697, 699, 700, 701, 703, 704, 706, 707, 708, 711, 712, 714, 716, 717, 718, 719, 722, 723, 727, 728, 729, 731, 733, 735, 736, 737, 739, 740, 741, 742, 745, 747, 751, 752, 753, 757, 758, 760, 763, 768, 771, 772, 775, 778, 779, 780, 781, 782, 787, 789, 795, 797, 799, 800, 803, 804, 805, 808, 809, 810, 812, 813, 815, 817, 818, 820, 824, 827, 828, 829, 830, 832, 833, 834, 835, 836, 838, 839, 840, 842, 843, 846, 847, 848, 849, 850, 851, 852, 854, 856, 859, 861, 863, 867, 868, 869, 870, 876, 879, 880, 881, 883, 885, 886, 887, 890, 891, 894, 896, 897, 900, 901, 905, 906, 908, 912, 914, 915, 919, 922, 924, 925, 927, 928, 929, 930, 931, 933, 934, 935, 936, 937, 939, 940, 943, 950, 951, 953, 954, 959, 960, 962, 963, 964, 965, 966, 967, 968, 969, 971, 974, 975, 978, 981, 986, 991, 992, 994, 998]
Number of False Positives (FP): 489
Indices of False Negatives (FN): [14, 107, 188, 555]
Number of False Negatives (FN): 4
Indices of True Negatives (TN): [0, 1, 3, 4, 8, 9, 10, 11, 15, 17, 18, 19, 21, 26, 30, 31, 33, 35, 37, 39, 44, 50, 52, 53, 56, 58, 60, 64, 67, 70, 71, 73, 75, 76, 77, 78, 79, 82, 84, 85, 89, 90, 91, 93, 96, 97, 105, 110, 113, 114, 116, 118, 120, 122, 125, 126, 130, 131, 132, 139, 140, 142, 144, 147, 148, 150, 151, 153, 157, 161, 162, 163, 166, 171, 176, 178, 183, 184, 187, 193, 194, 197, 199, 200, 204, 206, 209, 211, 214, 219, 229, 232, 233, 235, 238, 239, 240, 242, 244, 245, 247, 248, 252, 255, 259, 260, 263, 265, 266, 274, 276, 277, 278, 280, 285, 287, 288, 291, 292, 293, 297, 298, 300, 303, 306, 309, 310, 311, 312, 315, 316, 317, 320, 321, 322, 324, 327, 328, 329, 331, 333, 339, 342, 343, 344, 345, 346, 348, 351, 352, 354, 355, 356, 358, 359, 361, 363, 364, 366, 368, 375, 376, 380, 383, 389, 390, 391, 394, 396, 400, 401, 405, 407, 408, 413, 414, 416, 419, 421, 423, 425, 427, 428, 429, 431, 432, 435, 439, 440, 441, 443, 444, 446, 449, 450, 451, 452, 454, 456, 459, 469, 474, 481, 482, 483, 484, 487, 488, 490, 492, 493, 506, 507, 509, 511, 512, 513, 515, 519, 523, 528, 529, 530, 531, 534, 535, 536, 538, 539, 547, 552, 557, 558, 559, 563, 565, 567, 568, 572, 573, 578, 579, 581, 583, 585, 588, 589, 591, 592, 593, 594, 595, 597, 600, 602, 603, 609, 613, 614, 615, 617, 621, 622, 625, 626, 635, 636, 640, 642, 644, 648, 649, 650, 660, 663, 665, 666, 670, 672, 673, 674, 675, 676, 679, 680, 681, 683, 685, 686, 687, 695, 698, 702, 705, 710, 713, 715, 721, 724, 725, 726, 730, 738, 744, 748, 750, 755, 756, 759, 761, 762, 764, 765, 766, 769, 770, 773, 774, 776, 777, 783, 784, 785, 788, 790, 791, 796, 798, 802, 806, 807, 811, 814, 819, 821, 822, 823, 825, 826, 831, 841, 844, 845, 853, 855, 857, 858, 860, 862, 864, 865, 866, 871, 873, 874, 877, 878, 882, 884, 888, 889, 892, 893, 895, 898, 902, 903, 904, 907, 909, 910, 911, 913, 918, 920, 921, 923, 926, 932, 938, 942, 944, 946, 947, 948, 949, 952, 955, 956, 957, 958, 961, 972, 973, 976, 977, 979, 980, 982, 983, 984, 985, 987, 988, 989, 990, 993, 995, 996, 997, 999]
Number of True Negatives (TN): 411
Indices of True Positives (TP): [13, 27, 28, 29, 38, 43, 46, 86, 102, 109, 112, 117, 133, 145, 152, 154, 173, 190, 207, 212, 218, 222, 228, 231, 237, 251, 257, 258, 272, 289, 290, 296, 305, 308, 347, 349, 378, 385, 388, 399, 406, 411, 442, 463, 472, 475, 476, 477, 503, 505, 508, 518, 545, 561, 569, 575, 605, 616, 618, 620, 627, 628, 630, 637, 639, 643, 646, 654, 657, 659, 662, 678, 709, 720, 732, 734, 743, 746, 749, 754, 767, 786, 792, 793, 794, 801, 816, 837, 872, 875, 899, 916, 917, 941, 945, 970]
Number of True Positives (TP): 96
Filtered FN indices: [14, 107, 188, 555]
Number of filtered FNs: 4
Filtered FP indices: [5, 34, 36, 48, 80, 104, 124, 129, 138, 143, 149, 155, 169, 172, 175, 189, 227, 236, 241, 299, 304, 307, 318, 330, 337, 340, 362, 365, 426, 437, 458, 495, 497, 498, 500, 525, 544, 550, 584, 598, 606, 638, 647, 652, 658, 677, 682, 688, 690, 693, 707, 745, 747, 809, 820, 840, 842, 869, 924, 934, 960, 964, 967]
Number of filtered FPs: 63
--------------------Permutation importance for RF ------------------------
Baseline Recall: 0.96
<class 'numpy.ndarray'>
android.intent.action.MAIN: 0.22499999999999998
android.intent.action.VIEW: 0.18333333333333332
android.permission.WRITE_EXTERNAL_STORAGE: 0.12099999999999997
android.permission.CAMERA: 0.08699999999999997
android.permission.ACCESS_WIFI_STATE: 0.0753333333333333
android.permission.READ_EXTERNAL_STORAGE: 0.0743333333333333
android.intent.action.BOOT_COMPLETED: 0.07366666666666662
android.permission.ACCESS_FINE_LOCATION: 0.05299999999999995
android.permission.ACCESS_COARSE_LOCATION: 0.051999999999999956
android.intent.action.ACTION_POWER_CONNECTED: 0.05199999999999994
android.permission.RECEIVE_BOOT_COMPLETED: 0.04866666666666661
android.intent.action.TIME_SET: 0.04666666666666659
android.intent.action.TIMEZONE_CHANGED: 0.0456666666666666
android.intent.action.BATTERY_LOW: 0.043333333333333286
android.intent.action.BATTERY_OKAY: 0.043333333333333286
android.intent.action.DEVICE_STORAGE_OK: 0.043333333333333286
android.permission.READ_PHONE_STATE: 0.04299999999999994
Ljava/lang/StringBuilder;->append: 0.028999999999999953
Ljava/lang/StringBuilder;->toString: 0.028999999999999953
Ljava/io/FileInputStream;->close: 0.027666666666666624
Creating Counterfactuals....
Malware: 1
Column Name: android.hardware.location
Column Name: android.hardware.location.network
Column Name: android.hardware.telephony
Column Name: android.hardware.wifi
Generating Counterfactuals....
Counterfactual Explanations:
Counterfactual 1 (Changed Features):
android.permission.READ_PHONE_NUMBERS: Original=0, Counterfactual=1
android.software.leanback: Original=0, Counterfactual=1
Counterfactual 2 (Changed Features):
android.hardware.wifi: Original=1, Counterfactual=0
Landroid/speech/SpeechRecognizer;->cancel: Original=0, Counterfactual=1
Malware: 1
Column Name: android.permission.READ_PHONE_STATE
Column Name: android.permission.RECORD_AUDIO
Column Name: android.permission.WRITE_EXTERNAL_STORAGE
Column Name: android.permission.ACCESS_WIFI_STATE
Column Name: android.permission.READ_LOGS
Column Name: android.hardware.microphone
Column Name: android.intent.action.MAIN
Column Name: android.intent.action.VIEW
Column Name: Landroid/content/Context;->getClassLoader
Column Name: Landroid/content/Context;->getFilesDir
Column Name: Landroid/content/Context;->getPackageName
Column Name: Landroid/content/Context;->getResources
Column Name: Landroid/content/res/AssetManager;->open
Column Name: Ljava/io/FileInputStream;->close
Column Name: Ljava/io/FileInputStream;->read
Column Name: Ljava/io/FileOutputStream;->flush
Column Name: Ljava/io/FileOutputStream;->write
Column Name: Ljava/io/RandomAccessFile;->close
Column Name: Ljava/lang/StringBuilder;->append
Column Name: Ljava/lang/StringBuilder;->toString
Column Name: Ljava/lang/System;->currentTimeMillis
Column Name: Ljava/lang/System;->exit
Column Name: Ljava/lang/System;->load
Column Name: Ljava/lang/System;->loadLibrary
Generating Counterfactuals....
No Counterfactuals found for the given configuration, perhaps try with different parameters... ; total time taken: 04 min 49 sec
